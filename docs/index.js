function e(){const t=new Blob(['var g=[],l=[],C=["\\u{1F37F}","\\u{1F33D}","\\u{1F964}","\\u{1F968}","\\u{1FAD0}","\\u{1F363}"],z=["\\u2728","\\u2B50\\uFE0F","\\u{1F4A5}","\\u{1F31F}","\\u{1F525}","\\u{1F4AB}"],T=["\\u{1F680}","\\u{1F9E8}","\\u{1F4A3}","\\u{1FA84}","\\u{1F6F8}"],p=new Map,c,r,u,d;self.onmessage=async e=>{e.data.type==="init"?(c=e.data.canvas,r=c.getContext("2d"),u=c.width,d=c.height,await I([...C,...z,...T]),requestAnimationFrame(S)):e.data.type==="spawn"?k(e.data.options):e.data.type==="resize"&&(u=e.data.width,d=e.data.height,c.width=u,c.height=d)};async function E(e,n=64){let t=new OffscreenCanvas(n,n),i=t.getContext("2d");return i.font=`${n}px serif`,i.textAlign="center",i.textBaseline="middle",i.fillText(e,n/2,n/2),await createImageBitmap(t)}async function I(e,n=64){for(let t of e)if(typeof t=="string"){if(!p.has(t)){let i=await E(t,n);p.set(t,i)}}else t instanceof ImageBitmap?p.has(t)||p.set(t,t):console.warn("Unsupported emoji item:",t)}function k(e){let{particleType:n="popcorn",originX:t=u/2,originY:i=d/2,count:h=20,size:f=30,minSpeed:m=5,maxSpeed:b=10,angle:y=-Math.PI/2,angleVariance:x=Math.PI/6,gravity:v=.2,lifeTime:M=100,fade:w=!0,explosionOptions:j={}}=e;if(n==="popcorn")for(let a=0;a<h;a++){let o=m+Math.random()*(b-m),s=y+(Math.random()-.5)*x,O=C[Math.floor(Math.random()*C.length)];l.push({type:"emoji",emoji:O,size:f,x:t,y:i,vx:Math.cos(s)*o,vy:Math.sin(s)*o,gravity:v,age:0,lifeTime:M,fade:w})}else if(n==="rocket")for(let a=0;a<h;a++){let o=m+Math.random()*(b-m),s=y+(Math.random()-.5)*x,O=T[Math.floor(Math.random()*T.length)];g.push({emoji:O,x:t,y:i,vx:Math.cos(s)*o,vy:Math.sin(s)*o,gravity:v,age:0,lifeTime:M,size:f,explosionOptions:j})}}function B(e,n,t={}){let{count:i=20,size:h=20,minSpeed:f=2,maxSpeed:m=7,angle:b=0,angleVariance:y=Math.PI*2,gravity:x=.1,lifeTime:v=80,fade:M=!0,emojiList:w=z}=t;for(let j=0;j<i;j++){let a=f+Math.random()*(m-f),o=b+(Math.random()-.5)*y,s=w[Math.floor(Math.random()*w.length)];l.push({type:"emoji",emoji:s,x:e,y:n,vx:Math.cos(o)*a,vy:Math.sin(o)*a,gravity:x,age:0,lifeTime:v,fade:M,size:h})}}function P(){for(let e=g.length-1;e>=0;e--){let n=g[e];n.vy+=n.gravity,n.x+=n.vx,n.y+=n.vy,n.age++,n.age>=n.lifeTime&&(B(n.x,n.y,n.explosionOptions),g.splice(e,1))}for(let e=l.length-1;e>=0;e--){let n=l[e];n.vy+=n.gravity,n.x+=n.vx,n.y+=n.vy,n.age++,n.age>=n.lifeTime&&l.splice(e,1)}}function A(){r.clearRect(0,0,u,d);for(let e of g){let n=p.get(e.emoji);n&&(r.globalAlpha=1,r.drawImage(n,e.x-e.size/2,e.y-e.size/2,e.size,e.size))}for(let e of l){let n=p.get(e.emoji);if(n){let t=e.fade?1-e.age/e.lifeTime:1;r.globalAlpha=t,r.drawImage(n,e.x-e.size/2,e.y-e.size/2,e.size,e.size),r.globalAlpha=1}}}function S(){P(),A(),requestAnimationFrame(S)}\n'],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);return URL.revokeObjectURL(e),n}var processed,idioms,siritoriList,meiroObj,remSize=parseInt(getComputedStyle(document.documentElement).fontSize),size=10,meiro=new Array(12),emojiParticle=initEmojiParticle(),score=0,counter=0,words=Array.from("アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲンヴガギグゲゴザジズゼゾダヂヅデドバビブベボパピプペポァィゥェォッャュー");loadConfig();function loadConfig(){localStorage.getItem("darkMode")==1&&document.documentElement.setAttribute("data-bs-theme","dark")}function toggleDarkMode(){localStorage.getItem("darkMode")==1?(localStorage.setItem("darkMode",0),document.documentElement.setAttribute("data-bs-theme","light")):(localStorage.setItem("darkMode",1),document.documentElement.setAttribute("data-bs-theme","dark"))}function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}function shuffle(e){for(let t=e.length;1<t;t--){const n=Math.floor(Math.random()*t);[e[n],e[t-1]]=[e[t-1],e[n]]}return e}function initEmojiParticle(){const t=document.createElement("canvas");Object.assign(t.style,{position:"fixed",pointerEvents:"none",top:"0px",left:"0px"}),t.width=document.documentElement.clientWidth,t.height=document.documentElement.clientHeight,document.body.prepend(t);const n=t.transferControlToOffscreen(),s=e();return s.postMessage({type:"init",canvas:n},[n]),globalThis.addEventListener("resize",()=>{const e=document.documentElement.clientWidth,t=document.documentElement.clientHeight;s.postMessage({type:"resize",width:e,height:t})}),{canvas:t,offscreen:n,worker:s}}function calcReply(){const e=new Array(size*size),t=document.getElementById("meiro").children;for(let n=0;n<size;n++){const s=t[n].children;for(let t=0;t<size;t++){const i=s[t].classList.contains("table-primary"),a=s[t].classList.contains("table-secondary"),o=meiro[n][t];o>0&&(i||a)&&(e[o-1]=s[t].textContent)}}return e}function findMeiroIndex(e){for(let t=0;t<size;t++)for(let n=0;n<size;n++)if(meiro[t][n]==e)return t*size+n;return-1}function prependIdiomLink(e,t){const n=document.createElement("a");n.textContent=e,n.href="https://www.google.com/search?q="+e+"とは",n.target="_blank",n.rel="noopener noreferer",t?n.className="btn btn-light m-1":n.className="btn btn-secondary m-1",n.role="button",solvedPanel.prepend(n)}function showSolved(e,t){const i=document.getElementById("meiro").children;let o=0,n=0,s=0;for(let r=0;r<counter;r++){const a=idioms[o];if(!processed[r])if(e[r]==a[n])n==a.length-1&&(prependIdiomLink(a,!0),s+=a.length),processed[r]=!0;else{prependIdiomLink(a,!1);const e=r-n;for(let t=e;t<e+a.length;t++){processed[t]=!0;const n=findMeiroIndex(t+1),s=i[Math.floor(n/size)].children[n%size];s.className="",s.classList.add("table-secondary")}if(t)break}n==a.length-1?(o+=1,n=1):n+=1}for(let e=0;e<Math.floor(s/3);e++)emojiParticle.worker.postMessage({type:"spawn",options:{particleType:"popcorn",originX:Math.random()*emojiParticle.canvas.width,originY:Math.random()*emojiParticle.canvas.height}});score+=s,document.getElementById("score").textContent=score}function showHint(){const e=calcReply();showSolved(e,!0)}function showAnswer(){const t=calcReply();showSolved(t,!1);const n=document.getElementById("meiro").children;for(let e=0;e<size;e++){const t=n[e].children;for(let n=0;n<size;n++)meiro[e][n]>0&&(t[n].className="",t[n].classList.add("table-danger"))}const e=document.getElementById("startButton");e.classList.remove("d-none"),e.textContent="スタート";const s=document.getElementById("answerButton");s.classList.add("d-none")}function startGame(){for(;solvedPanel.firstChild;)solvedPanel.removeChild(solvedPanel.firstChild);idioms=getIdioms(),generateGame();const e=document.getElementById("startButton");e.classList.add("d-none"),e.textContent="やり直し";const t=document.getElementById("answerButton");t.classList.remove("d-none")}function isPassableRoute(e,t,n){return n.length==4||n.length==3&&(e==0||e==size-1||t==0||t==size-1)}function isPassableNeighbor(e,t,n){return n.length>=3||n.length==2&&(e==0||e==size-1||t==0||t==size-1)}function getRoute(e,t,n,s){let o=getNeighborRoutes(e,t);if(!isPassableNeighbor(e,t,o))return!1;if(n==1&&0<=e-s){let n=!0;for(let i=1;i<=s;i++)if(o=getNeighborRoutes(e-i,t),!isPassableRoute(e-i,t,o)){n=!1;break}if(n)return[e-1,t,1]}if(n==2&&e+s<size){let n=!0;for(let i=1;i<=s;i++)if(o=getNeighborRoutes(e+i,t),!isPassableRoute(e+i,t,o)){n=!1;break}if(n)return[e+1,t,2]}if(n==3&&0<=t-s){let n=!0;for(let i=1;i<=s;i++)if(o=getNeighborRoutes(e,t-i),!isPassableRoute(e,t-i,o)){n=!1;break}if(n)return[e,t-1,3]}if(n==4&&t+s<size){let n=!0;for(let i=1;i<=s;i++)if(o=getNeighborRoutes(e,t+i),!isPassableRoute(e,t+i,o)){n=!1;break}if(n)return[e,t+1,4]}return!1}function getNeighborRoutes(e,t){const n=[];return 0<=e-1&&meiro[e-1][t]==0&&n.push([e-1,t,1]),e+1<size&&meiro[e+1][t]==0&&n.push([e+1,t,2]),0<=t-1&&meiro[e][t-1]==0&&n.push([e,t-1,3]),t+1<size&&meiro[e][t+1]==0&&n.push([e,t+1,4]),n}function paint(e,t,n,s){if(n==1){for(let n=0;n<s;n++)counter+=1,meiro[e-n][t]=counter;return[e-s+1,t]}if(n==2){for(let n=0;n<s;n++)counter+=1,meiro[e+n][t]=counter;return[e+s-1,t]}if(n==3){for(let n=0;n<s;n++)counter+=1,meiro[e][t-n]=counter;return[e,t-s+1]}for(let n=0;n<s;n++)counter+=1,meiro[e][t+n]=counter;return[e,t+s-1]}function generateGame(){let s=!0;for(;s;){let e=0,t=getRandomInt(1,size-1),i=!0;counter=0;for(let e=0;e<size;e++){meiro[e]=new Array(size);for(let t=0;t<size;t++)meiro[e][t]=0}let n=getRoute(e,t,-1,idioms[0].length),o=paint(e,t,n[2],idioms[0].length);e=o[0],t=o[1];let a=1;for(;i;){const r=shuffle(getNeighborRoutes(e,t));if(r.length==0)i=!1;else{let c=!0;for(let l=0;l<r.length;l++)if(n=getRoute(r[l][0],r[l][1],r[l][2],idioms[a].length-2),n){c=!1,paint(r[l][0],r[l][1],r[l][2],1),o=paint(n[0],n[1],n[2],idioms[a].length-2),e=o[0],t=o[1],(e==0||e==size-1||t==0||t==size-1)&&(i=!1,counter>20&&(s=!1,processed=new Array(counter))),a+=1;break}c&&(i=!1)}}}const e=document.getElementById("meiro");for(;e.firstChild;)e.removeChild(e.firstChild);for(let t=0;t<size;t++){const n=document.createElement("tr");e.appendChild(n);for(let t=0;t<size;t++){const e=document.createElement("td");e.textContent=words[getRandomInt(0,words.length)],n.appendChild(e),e.onclick=()=>{e.classList.toggle("table-primary")}}}const o=e.children;let n=0,t=0;for(let e=1;e<=counter;e++){const s=findMeiroIndex(e),a=idioms[n][t],i=o[Math.floor(s/size)].children[s%size];i.textContent=a,e==1&&i.classList.add("table-secondary"),t==idioms[n].length-1?(n+=1,t=1):t+=1}}function resizeFontSize(e){const t=document.getElementById("masu").offsetWidth,n=1.2,s=remSize*5,o=11,i=(t-s-o)/12/n;e.style.fontSize=i+"px"}function generateSiritoriCandidates(){const e={};for(const[t,n]of Object.entries(siritoriList))if(e[t]){const s=e[t].concat(n);e[t]=s}else e[t]=n;return e}function getIdioms(){const s=generateSiritoriCandidates(),t=Object.keys(s);let n=t[getRandomInt(0,t.length)],e=[],o=!0;for(;o;){for(let o=0;o<30;o++){const t=s[n];if(t){{let s=!0;for(let i=0;i<5;i++){const o=t[getRandomInt(0,t.length)];if(n=o[o.length-1],!e.includes(o)){e.push(o),s=!1;break}}if(s)break}}else break}e.length==30?o=!1:(n=t[getRandomInt(0,t.length)],e=[])}return e}meiroObj=document.getElementById("meiro"),resizeFontSize(meiroObj),globalThis.addEventListener("resize",()=>{resizeFontSize(meiroObj)}),fetch("siritori.json").then(e=>e.json()).then(e=>{for(siritoriList=e,idioms=getIdioms(),generateGame();solvedPanel.firstChild;)solvedPanel.removeChild(solvedPanel.firstChild);showAnswer()}),document.getElementById("toggleDarkMode").onclick=toggleDarkMode,document.getElementById("startButton").onclick=startGame,document.getElementById("answerButton").onclick=showAnswer,document.getElementById("hintButton").onclick=showHint